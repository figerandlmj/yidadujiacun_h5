<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" type="text/css" href="css/public.css">
    <link rel="stylesheet" type="text/css" href="css/idangerous.swiper.css">
    <link rel="stylesheet" type="text/css" href="css/banner.css">
    <link rel="stylesheet" type="text/css" href="css/holiday.css">
    <style type="text/css">
    table{
    	width:100%;
    	height:40px;
    	/*border:1px solid #eee;*/
    	color:#5b5b5b;
    	float:left;
    }
    th,td{
    	text-align: left;
        font-size: .14rem;
    	/*border:1px solid #eee;*/
    }
    </style>
    <title>度假村</title>
</head>
<body>
<div id="main">
	<div class="header cf">
		<a  class="back">返回</a>
		<p class="title">度假村</p>
		<p class="header-right">
			<!-- <a href="#" class="share fr">分享</a> -->
			<a class="shoucan fr" id="collection"></a>
		</p>
	</div>
	<div class="holiday-village bg-f" id="add_room">
		<!-- <div class="banner">
			<img src="images/banner2.jpg" alt="">
			<div class="bottom-bar"></div>
			<p>
				<span class="fl">度假酒店</span>
				<span class="fr"><em class="fl"></em><label class="satisfaction">0</label>%满意度</span>
			</p>
		</div> -->
        <div class="banner">
            <div class="device">
                <a class="arrow-left" href="#" style="display: none"></a> 
                <a class="arrow-right" href="#" style="display: none"></a>
                <div class="swiper-container">
                    <div class="swiper-wrapper" id="sight-banner">
                        <!-- <div class="swiper-slide"> <img src="images/banner9.jpg"> </div>
                        <div class="swiper-slide"> <img src="images/banner9.jpg"> </div>
                        <div class="swiper-slide"> <img src="images/banner9.jpg"></div>
                        <div class="swiper-slide"> <img src="images/banner9.jpg"></div>
                        <div class="swiper-slide"> <img src="images/banner9.jpg"></div> -->
                    </div>
                </div>
                <div class="pagination"></div>
            </div>
        </div>

         <div class="statis">
            <div class="bottom-bar" style="top:256px;"></div>
            <p style="line-height:.14rem;">
                <span class="fl">度假酒店</span>
            </p>
        </div>

		<div class="holiday-info">
			<div class="htitle-style cf">
				<span class="fl" id="villageName"></span>
			</div>
            <div class="htitle-style cf" id="spacial" style="border-top: .01rem solid #eee;">
                <span class="spacial"><a>特色/详情</a></span>
                 <a class="arrow"></a>
            </div>
			<div style="display:none;" id="spacial_div">
				<div id="description" style="padding:1.7% 0 0 2%;"></div>
				<div id="feature" style="padding:1.7% 0 0 2%;font-size: 14px;"></div>
			</div>
			<div class="cf"></div>
			<div class="address" id="skip_map" style="border-top: .01rem solid #eee;">
				<em class="fl"></em>
				<span class="fl">景点地址：</span>
				<p class="span1 fl" id="seceryAddress" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;font-size: .15rem;width:50%;"></p>
				<a class="icon2 fr"></a>
			</div>
			<div class="part3 cf">
				<div class="part3-left fl" style="border-right:0;">
					<!-- <span class="review">共<i id="evaluateNum">0</i>条评论</span> -->
					<p class="fl">
						<span id="current_date"></span>
						<span>入住3晚</span>
					</p>
					<p class="updata fr" id="update"><a style="color: #fff;">修改</a></p>
				</div>
				<div class="part3-right fr" id="evaluate_btn">
					<p class="fl">
						<span class="star">
							<em></em>
							<em></em>
							<em></em>
							<em></em>
							<em></em>
						</span>
						<span class="review">共<i id="evaluateNum">0</i>条评论</span>
					</p>
					<p class="score fr" ><label class="satisfaction">0</label>%</p>
				</div>
			</div>
		</div>
		<!-- <div class="room cf">
			<div class="room-left fl">
				<p>房间类型名称</p>
				<p>面积&nbsp;床型&nbsp;早餐</p>
				<p><span class="fl">惠：满5人立减10元</span><em>返积分600</em></p>
			</div>
			<div class="room-right fr">
				<p class="price1">$160</p>
				<p class="price2">$148</p>
				<p class="pay">在线支付</p>
				<p class="pay2"><a href="write_order.html">预定</a></p>
			</div>
		</div>
		<div class="room cf">
			<div class="room-left fl">
				<p>房间类型名称</p>
				<p>面积&nbsp;床型&nbsp;早餐</p>
				<p><span class="fl">惠：满5人立减10元</span><em>返积分600</em></p>
			</div>
			<div class="room-right fr">
				<p class="price1">$160</p>
				<p class="price2">$148</p>
				<p class="pay">在线支付</p>
				<p class="pay2"><a href="write_order.html">预定</a></p>
			</div>
		</div> -->
	</div>
	<div style="margin-top:20px;"><img src="images/bottom.png" width="100%"></div>
	<div class="share-box">
		<h2 class="shareTo">分享到</h2>
		<ul class="mui-flex">
			<li class="cell -mob-share-weixin">
                <a>
                    <em></em>
                    <p>微信</p>
                </a>
            </li>
            <li class="cell -mob-share-qzone">
                <a>
                    <em></em>
                    <p>空间</p>
                </a>
            </li>
            <li class="cell -mob-share-weixin">
                <a>
                    <em></em>
                    <p>微信朋友圈</p>
                </a>
            </li>
            <li class="cell -mob-share-qq">
                <a>
                    <em></em>
                    <p>QQ好友</p>
                </a>
            </li>
		</ul>
        <div class="share-reset">取消</div>
	</div>
</div>
<script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=ecd551ee2f8c"></script>
<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script src="js/common.js"></script>
<script type="text/javascript" src="js/idangerous.swiper.min.js"></script>
<script type="text/javascript" src="js/swiper.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script>
	var sightspot_id = getLocalStorage("sightspot_id");
	var token = getLocalStorage("token");
    var data = {sightspot_id: sightspot_id};
    console.log(sightspot_id);
    ajaxGetRequest(kBaseSeceryDetailUrl+token, data, handleSeceryDetail);
    function handleSeceryDetail(result){
    	console.log(result);
        if(result.errorCode == 0){
            var message = result.message.sightspot;

            /*景点轮播图*/
            var sightBannerJson = message.image;
            var bannerHtml = "";
            for(var i=0; i<sightBannerJson.length; i++){
                bannerHtml += '<div class="swiper-slide">';
                bannerHtml +=   '<img src="'+kBaseImagePath+sightBannerJson[i]+'" width="640" height="240px">';
                bannerHtml += '</div>';
            }
            $("#sight-banner").html(bannerHtml);
            ZMSlide();
            $(".pagination").hide();

            // $(".banner img").attr("src", kBaseImagePath + message.image[0]);
            $("#villageName").text(message.name);
            $("#description").html("<label style='font-size: .18rem;'>详情:</label>"+message.description);
            $("#description").find("img").each(function(){
                var this_src=$(this).attr("src");
                $(this).attr("src",kBaseImagePath02+this_src);
            })
            if(message.feature!=""){
            	$("#feature").html("<label style='font-size: .18rem;'>特色:</label><br>"+message.feature+"<br><br>");
            }
            $("#seceryAddress").text(message.province_name+message.city_name+message.address);
            setLocalStorage("address",message.province_name+message.city_name+message.address);
            $("#evaluateNum").text(message.evaluate_num);
            $(".satisfaction").text(message.satisfaction);
            $("#current_date").text(getDate());
            // 收藏显示
            if(result.message.is_collected==true){
                $("#collection").text("已收藏");
                $("#collection").addClass("removeCollection");
            }else{
                $("#collection").text("收藏");
                $("#collection").addClass("collection");
            }
            // 优惠
            // var favorable_html='惠：';
            // if(result.message.first_order_favorable!=false){
                // favorable_html+='<label>首单立减'+result.message.first_order_favorable+'元</label><a class="more add-more"></a>';
                // favorable_html+='<label>首单立减'+result.message.first_order_favorable+'元</label>';
                // if(result.message.favorable.length>0){
                //     favorable_html+="<br><label style='display:none;' class='more_favorable'>";
                //     for(var i=0;i<result.message.favorable.length;i++){
                //         favorable_html+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;满"+result.message.favorable[i].satisfy+"元立减"+result.message.favorable[i].reduce+"元<br>";
                //     }
                //     favorable_html+="</label>";
                // }
            // }
            // else if(result.message.favorable.length>0){
            //     favorable_html+='<label>满'+result.message.favorable[0].satisfy+'元立减'+result.message.favorable[0].reduce+'元</label><a class="more add-more"></a>';
            //     favorable_html+="<br><label style='display:none;' class='more_favorable'>";
            //     for(var i=1;i<result.message.favorable.length;i++){
            //         favorable_html+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;满"+result.message.favorable[i].satisfy+"元立减"+result.message.favorable[i].reduce+"元<br>";
            //     }
            //     favorable_html+="</label>";
            // }
            // else{
            //     favorable_html+="暂无！";
            // }
            // 房间列表 
            if(message.houses.length>0){
                for(var i=0;i<message.houses.length;i++){

                    var favorable_html='惠：';
                    if(message.houses[i].first_favorable!=0){
                        favorable_html+='<label>首单立减'+message.houses[i].first_favorable+'元</label>';
                    }else{
                        favorable_html+="暂无！";
                    }

                    var return_integral=message.houses[i].return_integral;
                    var return_integral_html='';
                    if(return_integral!=0){
                        var return_integral_html='<p><em>返积分'+return_integral+'</em></p>';
                    }
                    var houses_html='<div class="room cf"><div class="room-left fl"><p class="fl">'+message.houses[i].house_type+'</p>'+return_integral_html+'<br><table border="0" cellspacing="0" cellpadding="0"><td>'+message.houses[i].area+'平方米</td><td>'+message.houses[i].bed_type+'</td><td>'+message.houses[i].breakfast+'</td></tr></table><p style="clear:both;"><span class="fl">'+favorable_html+'</span></p></div><div class="room-right fr"><p class="price1">￥'+message.houses[i].origin_price+'</p><p class="price2">￥'+message.houses[i].yida_price+'</p><p class="pay">在线支付</p><p class="pay2"><a href="write_order.html" data-id="'+message.houses[i].id+'" id="reserve">预订</a></p></div></div>'
                    $("#add_room").append(houses_html);
                }
            }
            // 点击更多显示更多优惠
            // $(".more").live("click",function(){
            //     $(this).toggleClass("reduce-more");
            //     $(this).siblings(".more_favorable").toggle();
            // })
            // 修改点击事件
		    $("#update").on("click",function(){
		    	if(message.houses.length>0){
		    		house_id=message.houses[0].id;
		        	setLocalStorage("house_id",house_id);
		        	location.href="write_order.html";
		    	}else{
		    		ZMAlert("暂无房型！");
		    	}
		    });  
        }
    }
    // 预定点击事件
    $("body").on("click","#reserve",function(){
        house_id=$(this).data("id");
        setLocalStorage("house_id",house_id);
    })

    // 点击返回事件
    $(".back").on("click",function(){
    	var sightspot_return = getLocalStorage("sightspot_return");
    	if(sightspot_return==1){
    		location.href="holiday.html";
    	}else if(sightspot_return==2){
    		location.href="myCollection.html";
    	}else if(sightspot_return==3){
            location.href="browse_history.html";
        }else{
    		location.href="holiday-list02.html";
    	}
    })
    // 跳转到地图
    $("#skip_map").on("click",function(){
    	setLocalStorage("sightspot_detail_return",1);
    })

    /*收藏按钮*/
    $("#collection").on("click",function(){
       var item_id = sightspot_id;
        if($(this).hasClass("collection")){
            var url = kBaseCollectionUrl + token;
            var data = {
                item_id: item_id,
                type:1
            }
            ajaxPOSTRequest(url, data, handleCollection);
            function handleCollection(result){
                console.log(result);
                ZMAlert(result.message,callback);
                function callback(){
                    if(result.errorCode==0){
                        $("#collection").text("已收藏");
                        $("#collection").removeClass("collection");
                        $("#collection").addClass("removeCollection");
                    }
                }
            }
        }else{
            var url = kBaseRemoveCollectionUrl + token+"&item_id="+item_id+"&type="+1;
            ajaxGetRequest(url, {}, handleCollection02);
            function handleCollection02(result){
                ZMAlert(result.message,callback02);
                function callback02(){
                   if(result.errorCode==0){
                        $("#collection").text("收藏");
                        $("#collection").addClass("collection");
                        $("#collection").removeClass("removeCollection");
                    }
                }
                
            }
        }
        
    });

    // 特色详情
    $("#spacial").on("click",function(){
        $(this).find("a.arrow").toggleClass("hover");
    	$("#spacial_div").slideToggle();
    })

    // 地址跳转
    $("#skip_map").on("click",function(){
        location.href="map.html";
    })
    /*跳转评价列表*/
    $("#evaluate_btn").on("click",function(){
        var data = {item_id: sightspot_id};
        ajaxGetRequest(kBaseEvaluateListUrl, data, handReviewList);
        function handReviewList(result){
            if(result.errorCode == 0){
                setLocalStorage("review_return",0);
                location.href = "review.html";
            }
        }    
    });
</script>
</body>
</html>